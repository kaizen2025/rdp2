<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Métriques IA - Monitoring Temps de Réponse</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2rem;
            font-weight: 300;
        }

        .header .subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1rem;
            margin-top: 0.5rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }

        .metric-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .metric-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
        }

        .icon-success { background: #27ae60; }
        .icon-warning { background: #f39c12; }
        .icon-error { background: #e74c3c; }
        .icon-info { background: #3498db; }
        .icon-primary { background: #9b59b6; }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .metric-unit {
            font-size: 1rem;
            color: #7f8c8d;
            font-weight: 400;
        }

        .metric-trend {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        .trend-up { color: #27ae60; }
        .trend-down { color: #e74c3c; }
        .trend-stable { color: #95a5a6; }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 1rem;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        .alerts-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .alert-item {
            display: flex;
            align-items: center;
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 10px;
            border-left: 4px solid;
        }

        .alert-critical {
            background: #ffebee;
            border-color: #e74c3c;
        }

        .alert-high {
            background: #fff3e0;
            border-color: #f39c12;
        }

        .alert-medium {
            background: #e3f2fd;
            border-color: #3498db;
        }

        .alert-low {
            background: #f1f8e9;
            border-color: #27ae60;
        }

        .alert-icon {
            margin-right: 1rem;
            font-size: 1.2rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
        }

        .alert-time {
            font-size: 0.8rem;
            color: #7f8c8d;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }

        .status-online { background: #27ae60; }
        .status-offline { background: #e74c3c; }
        .status-warning { background: #f39c12; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .service-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .service-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .service-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .service-metrics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .service-metric {
            text-align: center;
        }

        .service-metric-value {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .service-metric-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-top: 0.2rem;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: rgba(255, 255, 255, 0.8);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-wrapper {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-chart-line"></i> Dashboard Métriques IA</h1>
        <div class="subtitle">Monitoring Temps de Réponse et Performance Services IA</div>
    </div>

    <div class="container">
        <!-- Métriques principales -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">
                        <div class="metric-icon icon-primary">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        Requêtes/sec
                    </div>
                </div>
                <div class="metric-value" id="rps-value">0<span class="metric-unit"> req/s</span></div>
                <div class="metric-trend" id="rps-trend">
                    <i class="fas fa-minus trend-stable"></i> Stable
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">
                        <div class="metric-icon icon-success">
                            <i class="fas fa-clock"></i>
                        </div>
                        Temps Réponse Moyen
                    </div>
                </div>
                <div class="metric-value" id="avg-response">0<span class="metric-unit"> ms</span></div>
                <div class="metric-trend" id="response-trend">
                    <i class="fas fa-minus trend-stable"></i> Stable
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">
                        <div class="metric-icon icon-info">
                            <i class="fas fa-percentage"></i>
                        </div>
                        Taux de Succès
                    </div>
                </div>
                <div class="metric-value" id="success-rate">100<span class="metric-unit">%</span></div>
                <div class="metric-trend" id="success-trend">
                    <i class="fas fa-check-circle trend-up"></i> Excellent
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">
                        <div class="metric-icon icon-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        Alertes Actives
                    </div>
                </div>
                <div class="metric-value" id="active-alerts">0<span class="metric-unit"> alertes</span></div>
                <div class="metric-trend" id="alert-trend">
                    <i class="fas fa-check-circle trend-up"></i> Système OK
                </div>
            </div>
        </div>

        <!-- État des services -->
        <div class="service-status" id="services-status">
            <div class="service-card">
                <div class="service-name">
                    <span class="status-indicator status-online"></span>
                    Ollama IA
                </div>
                <div class="service-metrics">
                    <div class="service-metric">
                        <div class="service-metric-value" id="ollama-response">--</div>
                        <div class="service-metric-label">Réponse (ms)</div>
                    </div>
                    <div class="service-metric">
                        <div class="service-metric-value" id="ollama-throughput">--</div>
                        <div class="service-metric-label">Débit (req/s)</div>
                    </div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="status-indicator status-online"></span>
                    EasyOCR
                </div>
                <div class="service-metrics">
                    <div class="service-metric">
                        <div class="service-metric-value" id="ocr-response">--</div>
                        <div class="service-metric-label">Traitement (ms)</div>
                    </div>
                    <div class="service-metric">
                        <div class="service-metric-value" id="ocr-accuracy">--</div>
                        <div class="service-metric-label">Précision (%)</div>
                    </div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="status-indicator status-online"></span>
                    DocuCortex IA
                </div>
                <div class="service-metrics">
                    <div class="service-metric">
                        <div class="service-metric-value" id="ai-chat-response">--</div>
                        <div class="service-metric-label">Chat (ms)</div>
                    </div>
                    <div class="service-metric">
                        <div class="service-metric-value" id="ai-search-response">--</div>
                        <div class="service-metric-label">Recherche (ms)</div>
                    </div>
                </div>
            </div>

            <div class="service-card">
                <div class="service-name">
                    <span class="status-indicator status-online"></span>
                    GED Services
                </div>
                <div class="service-metrics">
                    <div class="service-metric">
                        <div class="service-metric-value" id="ged-upload">--</div>
                        <div class="service-metric-label">Upload (MB/s)</div>
                    </div>
                    <div class="service-metric">
                        <div class="service-metric-value" id="ged-search">--</div>
                        <div class="service-metric-label">Recherche (ms)</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Graphiques -->
        <div class="chart-container">
            <div class="chart-title">
                <i class="fas fa-chart-line"></i> Temps de Réponse en Temps Réel
            </div>
            <div class="chart-wrapper">
                <canvas id="responseTimeChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">
                <i class="fas fa-chart-bar"></i> Débit des Requêtes
            </div>
            <div class="chart-wrapper">
                <canvas id="throughputChart"></canvas>
            </div>
        </div>

        <div class="chart-container">
            <div class="chart-title">
                <i class="fas fa-pie-chart"></i> Répartition des Erreurs par Service
            </div>
            <div class="chart-wrapper">
                <canvas id="errorDistributionChart"></canvas>
            </div>
        </div>

        <!-- Alertes -->
        <div class="alerts-container">
            <div class="chart-title">
                <i class="fas fa-bell"></i> Alertes et Notifications
            </div>
            <div id="alerts-list">
                <div style="text-align: center; padding: 2rem; color: #7f8c8d;">
                    <i class="fas fa-check-circle" style="font-size: 2rem; color: #27ae60;"></i>
                    <div style="margin-top: 1rem;">Aucune alerte active</div>
                    <div style="margin-top: 0.5rem; font-size: 0.9rem;">Le système fonctionne normalement</div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div>Dashboard Métriques IA | Dernière mise à jour: <span id="last-update">--</span></div>
        <div style="margin-top: 0.5rem; font-size: 0.9rem;">
            Développé pour DocuCortex | Monitoring temps réel des performances
        </div>
    </div>

    <script>
        // Configuration des graphiques
        const chartConfig = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        };

        // Graphique temps de réponse
        const responseTimeCtx = document.getElementById('responseTimeChart').getContext('2d');
        const responseTimeChart = new Chart(responseTimeCtx, {
            type: 'line',
            data: {
                labels: [],
                datasets: [
                    {
                        label: 'Ollama',
                        data: [],
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'EasyOCR',
                        data: [],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'DocuCortex IA',
                        data: [],
                        borderColor: '#27ae60',
                        backgroundColor: 'rgba(39, 174, 96, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'GED',
                        data: [],
                        borderColor: '#f39c12',
                        backgroundColor: 'rgba(243, 156, 18, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                ...chartConfig,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Temps de Réponse (ms)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Temps'
                        }
                    }
                }
            }
        });

        // Graphique débit
        const throughputCtx = document.getElementById('throughputChart').getContext('2d');
        const throughputChart = new Chart(throughputCtx, {
            type: 'bar',
            data: {
                labels: [],
                datasets: [{
                    label: 'Requêtes par seconde',
                    data: [],
                    backgroundColor: 'rgba(52, 152, 219, 0.6)',
                    borderColor: '#3498db',
                    borderWidth: 1
                }]
            },
            options: {
                ...chartConfig,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Requêtes/sec'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Temps'
                        }
                    }
                }
            }
        });

        // Graphique erreurs
        const errorCtx = document.getElementById('errorDistributionChart').getContext('2d');
        const errorChart = new Chart(errorCtx, {
            type: 'doughnut',
            data: {
                labels: ['Ollama', 'EasyOCR', 'DocuCortex IA', 'GED', 'Réseau'],
                datasets: [{
                    data: [0, 0, 0, 0, 0],
                    backgroundColor: [
                        '#9b59b6',
                        '#3498db', 
                        '#27ae60',
                        '#f39c12',
                        '#e74c3c'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // Simulation des données (remplacer par des appels API réels)
        function simulateData() {
            const now = new Date();
            const timeLabel = now.toLocaleTimeString();
            
            // Simuler les temps de réponse
            const ollamaResponse = 800 + Math.random() * 400;
            const ocrResponse = 1200 + Math.random() * 600;
            const aiResponse = 600 + Math.random() * 300;
            const gedResponse = 400 + Math.random() * 200;

            // Simuler le débit
            const throughput = 5 + Math.random() * 10;

            // Ajouter aux graphiques
            addDataToChart(responseTimeChart, timeLabel, [ollamaResponse, ocrResponse, aiResponse, gedResponse]);
            addDataToChart(throughputChart, timeLabel, [throughput]);

            // Mettre à jour les métriques principales
            updateMainMetrics(throughput, (ollamaResponse + ocrResponse + aiResponse + gedResponse) / 4);
            updateServiceMetrics({
                ollama: ollamaResponse,
                ocr: ocrResponse,
                ai: aiResponse,
                ged: gedResponse
            });

            // Simuler quelques erreurs occasionnelles
            if (Math.random() < 0.1) {
                simulateError();
            }

            // Mettre à jour l'heure
            document.getElementById('last-update').textContent = new Date().toLocaleString();
        }

        function addDataToChart(chart, label, data) {
            // Limiter le nombre de points
            if (chart.data.labels.length > 20) {
                chart.data.labels.shift();
                chart.data.datasets.forEach(dataset => {
                    dataset.data.shift();
                });
            }

            chart.data.labels.push(label);
            if (Array.isArray(data)) {
                data.forEach((value, index) => {
                    chart.data.datasets[index].data.push(value);
                });
            } else {
                chart.data.datasets[0].data.push(data);
            }
            
            chart.update('none');
        }

        function updateMainMetrics(rps, avgResponse) {
            document.getElementById('rps-value').innerHTML = `${rps.toFixed(1)}<span class="metric-unit"> req/s</span>`;
            document.getElementById('avg-response').innerHTML = `${avgResponse.toFixed(0)}<span class="metric-unit"> ms</span>`;

            // Mettre à jour les tendances (simulation)
            const responseTrend = document.getElementById('response-trend');
            if (avgResponse > 1000) {
                responseTrend.innerHTML = '<i class="fas fa-arrow-up trend-down"></i> Augmentation';
            } else if (avgResponse < 500) {
                responseTrend.innerHTML = '<i class="fas fa-arrow-down trend-up"></i> Amélioration';
            } else {
                responseTrend.innerHTML = '<i class="fas fa-minus trend-stable"></i> Stable';
            }
        }

        function updateServiceMetrics(metrics) {
            document.getElementById('ollama-response').textContent = `${metrics.ollama.toFixed(0)}`;
            document.getElementById('ocr-response').textContent = `${metrics.ocr.toFixed(0)}`;
            document.getElementById('ai-chat-response').textContent = `${metrics.ai.toFixed(0)}`;
            document.getElementById('ged-search').textContent = `${metrics.ged.toFixed(0)}`;
            
            // Simuler les débits
            document.getElementById('ollama-throughput').textContent = (2 + Math.random() * 3).toFixed(1);
            document.getElementById('ocr-accuracy').textContent = (95 + Math.random() * 4).toFixed(1);
            document.getElementById('ai-search-response').textContent = `${(metrics.ai * 0.8).toFixed(0)}`;
            document.getElementById('ged-upload').textContent = `${(5 + Math.random() * 10).toFixed(1)}`;
        }

        function simulateError() {
            const services = ['Ollama', 'EasyOCR', 'DocuCortex IA', 'GED'];
            const service = services[Math.floor(Math.random() * services.length)];
            
            // Ajouter à la répartition des erreurs
            const currentData = errorChart.data.datasets[0].data;
            const serviceIndex = services.indexOf(service);
            if (serviceIndex !== -1) {
                currentData[serviceIndex] += 1;
                errorChart.update();
            }

            // Ajouter une alerte
            addAlert(`${service}: Timeout detected`, 'medium');
        }

        function addAlert(message, severity = 'low') {
            const alertsList = document.getElementById('alerts-list');
            
            // Supprimer le message "Aucune alerte" s'il existe
            if (alertsList.children.length === 1) {
                alertsList.innerHTML = '';
            }

            const alertElement = document.createElement('div');
            alertElement.className = `alert-item alert-${severity}`;
            alertElement.innerHTML = `
                <div class="alert-icon">
                    <i class="fas ${getAlertIcon(severity)}"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-title">${message}</div>
                    <div class="alert-time">${new Date().toLocaleString()}</div>
                </div>
            `;

            alertsList.insertBefore(alertElement, alertsList.firstChild);

            // Limiter le nombre d'alertes affichées
            if (alertsList.children.length > 10) {
                alertsList.removeChild(alertsList.lastChild);
            }

            // Mettre à jour le compteur d'alertes
            const activeAlerts = alertsList.querySelectorAll('.alert-item').length;
            document.getElementById('active-alerts').innerHTML = `${activeAlerts}<span class="metric-unit"> alertes</span>`;
        }

        function getAlertIcon(severity) {
            const icons = {
                critical: 'fa-exclamation-circle',
                high: 'fa-exclamation-triangle',
                medium: 'fa-info-circle',
                low: 'fa-check-circle'
            };
            return icons[severity] || 'fa-info-circle';
        }

        // Démarrer la simulation
        setInterval(simulateData, 2000); // Toutes les 2 secondes

        // Simulation initiale
        simulateData();

        // Configuration des seuils d'alerte
        const alertThresholds = {
            responseTime: {
                warning: 2000,
                critical: 5000
            },
            successRate: {
                warning: 90,
                critical: 80
            },
            throughput: {
                warning: 2,
                critical: 1
            }
        };

        // Fonction pour charger les vraies données (API)
        async function loadRealTimeData() {
            try {
                // Remplacer par vos vraies API endpoints
                const response = await axios.get('/api/metrics/realtime');
                const data = response.data;
                
                // Mettre à jour l'interface avec les vraies données
                updateMainMetrics(data.rps, data.avgResponseTime);
                updateServiceMetrics(data.services);
                
                // Mettre à jour les graphiques
                addDataToChart(responseTimeChart, new Date().toLocaleTimeString(), [
                    data.services.ollama.responseTime,
                    data.services.ocr.responseTime,
                    data.services.ai.responseTime,
                    data.services.ged.responseTime
                ]);
                
                addDataToChart(throughputChart, new Date().toLocaleTimeString(), [data.rps]);
                
            } catch (error) {
                console.warn('Erreur lors du chargement des données:', error);
                // Continuer avec la simulation si l'API n'est pas disponible
            }
        }

        // Pour utiliser les vraies données au lieu de la simulation,
        // décommenter cette ligne et commenter la simulation
        // setInterval(loadRealTimeData, 2000);
    </script>
</body>
</html>